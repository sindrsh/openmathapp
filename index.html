<!DOCTYPE html>
<html>
    <head>
        <style>
             /* Table styles*/
            .customTable {
                width: auto;
                font-family: Arial, Helvetica, sans-serif;
                border-collapse: collapse;
                }

            .customTable td, .customTable th {
                border: 1px solid #ddd;
                padding: 8px;
                }

            .customTable tr:nth-child(even){background-color: #f2f2f2;}

            .customTable td:hover {background-color: #ddd;}

            .customTable th {
                width: 180px;
                text-align: left;
                background-color: #04AA6D;
                color: white;
            }

            .customTable td {
                width: 60px;
            }
            
            body {
                font-family: sans-serif;   
            }

            .test {
                /*visibility: hidden;*/
            }

            .interactive {
                visibility: hidden;
            }


            #loginPage {
                padding: 20px;
                background-color:yellowgreen;
                height: 220px;
            }
            
            button {
                background-color: #04AA6D;
                color: white;
                padding: 14px 20px;
                margin: 8px 0;
                border: none;
                cursor: pointer;
                width: 100%;
                }

            input[type=text], input[type=password] {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: inline-block;
                border: 1px solid #ccc;
                box-sizing: border-box;
            }

            .category {
                width: 90px;
            }

            .medium {
                width: 80px;
            }
            .subject {
                width: 100px;
            }


            #mainPage {
                width: 1000px;
            }

        </style>
    </head>

    <body>
        <div id="loginPage" hidden>
            <label for="uname"><b>Username</b></label>
    <input type="text" placeholder="Enter Username" name="uname" required id="username">

    <label for="psw"><b>Password</b></label>
    <input type="password" placeholder="Enter Password" name="psw" required id="password">

    <button id="loginButton">Login</button>
    <label>
      <input type="checkbox" checked="checked" name="remember" id="rememberLoginInfo"> Remember me
    </label>
        </div>
        <div id="mainPage">
        <div> 
            <table class="customTable"> 
              <tbody id="titallsystemet">
                <tr>
                    <th rowspan="8" class="subject"> Titallsystemet</th>
                    <td rowspan="4" class="category">Mengde</td>
                </tr>
                <tr class="interactives">
                    <td class="medium">Video</td>
                    <td class="interactive"> </td>
                    <td class="interactive"> </td>
                </tr>
                <tr class="book">
                    <td>Bok</td>
                    <td> </td>
                    <td></td>
                </tr>
                <tr class="tests">
                    <td>Oppgaver</td> 
                    <td id="count_amounts_1_to_9.html">
                        <a class="test" id="count_amounts_1_to_9" href="assessments/counting/count_amounts_1_to_9.html"> Test 1</a>
                    </td>
                    <td>
                        <a class="test" id="count_ones_amounts_10_to_20" href="assessments/counting/count_ones_amounts_10_to_20.html"> Test 2</a>
                    </td>
                    <td>
                        <a class="test" id="count_amounts_10_to_99" href="assessments/counting/count_amounts_10_to_99.html"> Test 3</a>
                    </td>
                    <td>
                        <a class="test" id="count_amounts_100_to_999" href="assessments/counting/count_amounts_100_to_999.html"> Test 4</a>
                    </td>
                </tr>
              </tbody>
            </table>
        </div>
        </div>
    <script type="module">
        import { signIn } from "./data_module.js"
        //document.getElementById("mainPage").hidden = true
        let loginButton = document.getElementById("loginButton")
        loginButton.addEventListener("click", login)
        /*
        if (localStorage.getItem("username")) {
            document.getElementById("username").value = localStorage.getItem("username")
        }
        if (localStorage.getItem("password")) {
            document.getElementById("password").value = localStorage.getItem("password")
        }
        */
        function login() {
            let username = document.getElementById("username").value
            let password = document.getElementById("password").value
            signIn(username, password).then( (value) => {
                if (value) {
                    if (document.getElementById("rememberLoginInfo").checked == true) {
                        console.log("jamen")
                        localStorage.setItem("username", username)
                        localStorage.setItem("password", password)
                    }
                } else {
                    alert("Brukernavn eller passord er FULLSTENDIG FEIL!")
                }   
            }
            )
        } 
        
        for (let row of document.getElementsByClassName("tests")) {
            let tests = Array.from(row.getElementsByClassName("test"))
            tests[0].style.visibility = "visible"
            tests = tests.slice(0)
            let cnt = 0

            let testsFromLocalStorage = {}
        
            if (localStorage.getItem("tests")) {
                testsFromLocalStorage = JSON.parse(localStorage.getItem("tests"))
            }
            for (let i=0; i<tests.length-1; ++i) {
                if (tests[i].id in testsFromLocalStorage) {
                    if (testsFromLocalStorage[tests[i].id]["score"] == 2) {
                        ++cnt
                        tests[i+1].style.visibility = "visible"    
                    }
                    else {
                        break
                    }
                } else {
                    break
                }
            }
            let interactives = Array.from(row.parentNode.getElementsByClassName("interactive"))
            interactives[0].style.visibility = "visible"
            interactives = interactives.slice(0)
            for (let i of [...Array(interactives.length - cnt - 1)].keys()) {
                interactives[i].style.visibility = "visible"
            }
        }
    </script>    
    </body
</html>

